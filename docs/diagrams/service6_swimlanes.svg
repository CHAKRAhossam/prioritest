<svg viewBox="0 0 3600 2000" xmlns="http://www.w3.org/2000/svg">

  <!-- Title -->
  <text x="1800" y="60" text-anchor="middle" font-size="48" font-weight="bold" font-family="Arial, sans-serif" fill="#000">
    Service 6 - Moteur de Priorisation
  </text>

  <!-- ========== SWIMLANES ========== -->

  <!-- Swimlane 1: API -->
  <rect x="100" y="100" width="3400" height="280" fill="none" stroke="#000" stroke-width="2.5"/>
  <text x="40" y="245" font-size="28" font-weight="bold" font-family="Arial, sans-serif" fill="#000" transform="rotate(-90 40 245)">API</text>

  <!-- Swimlane 2: ML Integration -->
  <rect x="100" y="380" width="3400" height="280" fill="none" stroke="#000" stroke-width="2.5"/>
  <text x="40" y="525" font-size="28" font-weight="bold" font-family="Arial, sans-serif" fill="#000" transform="rotate(-90 40 525)">ML INTEGRATION</text>

  <!-- Swimlane 3: Processing -->
  <rect x="100" y="660" width="3400" height="300" fill="none" stroke="#000" stroke-width="2.5"/>
  <text x="40" y="815" font-size="28" font-weight="bold" font-family="Arial, sans-serif" fill="#000" transform="rotate(-90 40 815)">PROCESSING</text>

  <!-- Swimlane 4: Strategy -->
  <rect x="100" y="960" width="3400" height="280" fill="none" stroke="#000" stroke-width="2.5"/>
  <text x="40" y="1105" font-size="28" font-weight="bold" font-family="Arial, sans-serif" fill="#000" transform="rotate(-90 40 1105)">STRATEGY</text>

  <!-- Swimlane 5: Output -->
  <rect x="100" y="1240" width="3400" height="280" fill="none" stroke="#000" stroke-width="2.5"/>
  <text x="40" y="1385" font-size="28" font-weight="bold" font-family="Arial, sans-serif" fill="#000" transform="rotate(-90 40 1385)">OUTPUT</text>

  <!-- PostgreSQL -->
  <ellipse cx="400" cy="1380" rx="55" ry="25" fill="none" stroke="#000" stroke-width="2.5"/>
  <path d="M 345 1380 L 345 1420 Q 345 1435 400 1435 Q 455 1435 455 1420 L 455 1380" fill="none" stroke="#000" stroke-width="2.5"/>
  <text x="400" y="1475" text-anchor="middle" font-size="26" font-weight="bold" font-family="Arial, sans-serif">PostgreSQL</text>

  <!-- ========== LAYER 1: API ========== -->

  <!-- Start -->
  <circle cx="180" cy="240" r="35" fill="none" stroke="#000" stroke-width="3.5"/>
  <circle cx="180" cy="240" r="28" fill="none" stroke="#000" stroke-width="3.5"/>
  <text x="180" y="310" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Début</text>

  <line x1="215" y1="240" x2="310" y2="240" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Recevoir POST -->
  <rect x="310" y="160" width="280" height="160" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="450" y="205" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Recevoir requête</text>
  <text x="450" y="245" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">POST /prioritize</text>
  <text x="450" y="280" text-anchor="middle" font-size="19" font-family="Arial, sans-serif" fill="#666">repository_id, sprint_id</text>

  <line x1="590" y1="240" x2="700" y2="240" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Valider -->
  <rect x="700" y="160" width="260" height="160" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="830" y="215" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Valider requête</text>
  <text x="830" y="255" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">et paramètres</text>

  <line x1="960" y1="240" x2="1060" y2="240" stroke="#000" stroke-width="2.5"/>
  <line x1="1060" y1="240" x2="1060" y2="520" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Gateway Validation -->
  <path d="M 960 240 L 1000 200 L 1040 240 L 1000 280 Z" fill="#fff" stroke="#000" stroke-width="3"/>
  <text x="960" y="185" font-size="21" font-weight="bold" font-family="Arial, sans-serif">Invalide</text>
  <text x="1050" y="230" font-size="21" font-weight="bold" font-family="Arial, sans-serif">Valide</text>
  <line x1="1000" y1="280" x2="1000" y2="380" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>
  
  <!-- Error circle 422 -->
  <circle cx="1000" cy="420" r="28" fill="#fff" stroke="#000" stroke-width="3.5"/>
  <circle cx="1000" cy="420" r="22" fill="#000"/>
  <text x="1000" y="470" text-anchor="middle" font-size="20" font-weight="bold" font-family="Arial, sans-serif">Erreur 422</text>

  <!-- ========== LAYER 2: ML INTEGRATION ========== -->

  <!-- Appeler S5 -->
  <rect x="1000" y="480" width="240" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="1120" y="520" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Appeler S5</text>
  <text x="1120" y="550" text-anchor="middle" font-size="21" font-family="Arial, sans-serif">ML Service</text>
  <text x="1120" y="565" text-anchor="middle" font-size="19" font-family="Arial, sans-serif" fill="#666">GET /predictions</text>

  <line x1="1240" y1="530" x2="1340" y2="530" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Recevoir predictions -->
  <rect x="1340" y="480" width="280" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="1480" y="520" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Recevoir prédictions</text>
  <text x="1480" y="550" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">risk_score, loc,</text>
  <text x="1480" y="565" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">complexity</text>

  <line x1="1620" y1="530" x2="1720" y2="530" stroke="#000" stroke-width="2.5"/>
  <line x1="1720" y1="530" x2="1720" y2="800" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Gateway Predictions -->
  <path d="M 1620 530 L 1660 490 L 1700 530 L 1660 570 Z" fill="#fff" stroke="#000" stroke-width="3"/>
  <text x="1620" y="475" font-size="21" font-weight="bold" font-family="Arial, sans-serif">Vide</text>
  <text x="1710" y="520" font-size="21" font-weight="bold" font-family="Arial, sans-serif">OK</text>
  <line x1="1660" y1="490" x2="1660" y2="410" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>
  
  <!-- Error circle 404 -->
  <circle cx="1660" cy="350" r="28" fill="#fff" stroke="#000" stroke-width="3.5"/>
  <circle cx="1660" cy="350" r="22" fill="#000"/>
  <text x="1660" y="400" text-anchor="middle" font-size="20" font-weight="bold" font-family="Arial, sans-serif">Erreur 404</text>

  <!-- ========== LAYER 3: PROCESSING ========== -->

  <!-- Calculer Effort -->
  <rect x="1660" y="760" width="260" height="140" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="1790" y="810" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Calculer effort</text>
  <text x="1790" y="850" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">en heures</text>
  <text x="1790" y="880" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">par classe</text>

  <line x1="1920" y1="830" x2="2020" y2="830" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Effort-Aware Score -->
  <rect x="2020" y="760" width="280" height="140" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="2160" y="810" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Score effort-aware</text>
  <text x="2160" y="850" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">risk_score /</text>
  <text x="2160" y="880" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">effort_hours</text>

  <line x1="2300" y1="830" x2="2400" y2="830" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Criticité -->
  <rect x="2400" y="760" width="260" height="140" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="2530" y="810" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Criticité module</text>
  <text x="2530" y="850" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">auth, payment</text>
  <text x="2530" y="880" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">×1.5, ×1.2, ×1.0</text>

  <line x1="2660" y1="830" x2="2760" y2="830" stroke="#000" stroke-width="2.5"/>
  <line x1="2760" y1="830" x2="2760" y2="1100" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- ========== LAYER 4: STRATEGY ========== -->

  <!-- Appliquer Stratégie -->
  <rect x="2700" y="1060" width="260" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="2830" y="1100" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Appliquer stratégie</text>
  <text x="2830" y="1130" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">Popt@20, Top-K,</text>
  <text x="2830" y="1145" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">Budget, etc.</text>

  <line x1="2960" y1="1110" x2="3060" y2="1110" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Calculer Métriques -->
  <rect x="3060" y="1060" width="260" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="3190" y="1100" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Calculer métriques</text>
  <text x="3190" y="1130" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">Popt@20, Recall</text>
  <text x="3190" y="1145" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">Coverage Gain</text>

  <!-- Sauvegarder (optionnel) -->
  <line x1="3190" y1="1160" x2="3190" y2="1300" stroke="#000" stroke-width="2.5" stroke-dasharray="8,5" marker-end="url(#arrow-small)"/>
  <rect x="3100" y="1300" width="180" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2.5" stroke-dasharray="4,4"/>
  <text x="3190" y="1340" text-anchor="middle" font-size="21" font-weight="bold" font-family="Arial, sans-serif">Sauvegarder plan</text>
  <text x="3190" y="1375" text-anchor="middle" font-size="19" font-family="Arial, sans-serif">(Optionnel)</text>

  <!-- Ligne vers PostgreSQL -->
  <line x1="3100" y1="1350" x2="445" y2="1400" stroke="#000" stroke-width="2" stroke-dasharray="8,5"/>

  <line x1="3320" y1="1110" x2="3400" y2="1110" stroke="#000" stroke-width="2.5"/>
  <line x1="3400" y1="1110" x2="3400" y2="240" stroke="#000" stroke-width="2.5"/>
  <line x1="3400" y1="240" x2="3220" y2="240" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- ========== BACK TO LAYER 1 ========== -->

  <!-- Construire Response -->
  <rect x="2960" y="160" width="260" height="160" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="3090" y="215" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Construire réponse</text>
  <text x="3090" y="255" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">plan priorisé</text>

  <line x1="2960" y1="240" x2="2850" y2="240" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- Retourner 200 -->
  <rect x="2610" y="160" width="240" height="160" rx="10" fill="#fff" stroke="#000" stroke-width="2.5"/>
  <text x="2730" y="215" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Retourner 200 OK</text>
  <text x="2730" y="255" text-anchor="middle" font-size="20" font-family="Arial, sans-serif" fill="#666">(JSON)</text>

  <line x1="2610" y1="240" x2="2500" y2="240" stroke="#000" stroke-width="2.5" marker-end="url(#arrow-small)"/>

  <!-- End -->
  <circle cx="2470" cy="240" r="35" fill="#fff" stroke="#000" stroke-width="3.5"/>
  <circle cx="2470" cy="240" r="28" fill="#000"/>
  <text x="2470" y="310" text-anchor="middle" font-size="22" font-weight="bold" font-family="Arial, sans-serif">Fin</text>

  <!-- ========== ARROW MARKERS ========== -->
  <defs>
    <marker id="arrow-small" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#000"/>
    </marker>
  </defs>

</svg>